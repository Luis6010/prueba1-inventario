<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>Protege Bien - Inventario</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap');
        body { font-family: 'Montserrat', sans-serif; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        const StockBar = ({ actuales, totales }) => {
            const porcentaje = totales > 0 ? Math.min((actuales / totales) * 100, 100) : 0;
            let colorBarra = "bg-[#4a90e2]"; 
            if (porcentaje < 20) colorBarra = "bg-rose-500";
            else if (porcentaje < 50) colorBarra = "bg-amber-500";

            return (
                <div className="w-full mt-2">
                    <div className="flex justify-between text-[9px] mb-1 font-bold text-slate-400 uppercase">
                        <span>Disponibilidad</span>
                        <span className="text-[#002d5b]">{Math.round(porcentaje)}%</span>
                    </div>
                    <div className="w-full bg-slate-100 rounded-full h-1.5 overflow-hidden">
                        <div className={`h-full transition-all duration-700 ${colorBarra}`} style={{ width: `${porcentaje}%` }}></div>
                    </div>
                </div>
            );
        };

        function App() {
            const estructuraEmpresa = {
                "Tecnolog√≠a (TI)": ['Laptops', 'CPU', 'Celulares', 'Monitores', 'Teclados', 'Mouse', 'Cables', 'Impresoras', 'Telefonos', 'Mousepad', 'Extension', 'Cargadores', 'Adaptadores', 'Escaneres', 'Soporte Laptop', 'Soporte Pantalla', 'Pantalla', 'Repetidores', 'Preamplificadores', 'Switch', 'Alexa', 'Fuente Alimentacion', 'Memoria USB', 'Router', 'Camara', 'Disco', 'Trituradora', 'Convertidor', 'Transmisor', 'Control'],
                "Direccion": ['Paquetes Alcanfores', 'Paquetes Cerveza', 'Paquetes Para Tasas', 'Vinos', 'Tasas', 'Listones']
            };

            const [inventario, setInventario] = useState(() => {
                const datos = localStorage.getItem('it_inventory_data');
                return datos ? JSON.parse(datos) : [];
            });

            const [isSidebarOpen, setIsSidebarOpen] = useState(false);
            const [categoriaActiva, setCategoriaActiva] = useState("General");
            const [isModalOpen, setIsModalOpen] = useState(false);
            const [busqueda, setBusqueda] = useState("");
            const [busquedaRubro, setBusquedaRubro] = useState("");
            const [deptsAbiertos, setDeptsAbiertos] = useState({ "Tecnolog√≠a (TI)": true, "Direccion": true });
            const [nuevoEquipo, setNuevoEquipo] = useState({ idEtiqueta: '', categoria: '', nombre: '', funcionales: 0, noFuncionales: 0 });

            useEffect(() => {
                localStorage.setItem('it_inventory_data', JSON.stringify(inventario));
            }, [inventario]);

            const inventarioFiltrado = useMemo(() => {
                const term = busqueda.toLowerCase().trim();
                return inventario.filter((item) => {
                    let cumpleRubro = categoriaActiva === "General" || 
                        (estructuraEmpresa[categoriaActiva] ? estructuraEmpresa[categoriaActiva].includes(item.categoria) : item.categoria === categoriaActiva);
                    return cumpleRubro && (item.nombre.toLowerCase().includes(term) || item.idEtiqueta.toLowerCase().includes(term));
                });
            }, [inventario, categoriaActiva, busqueda]);

            const stats = useMemo(() => {
                const items = inventario.filter(i => categoriaActiva === "General" || (estructuraEmpresa[categoriaActiva] ? estructuraEmpresa[categoriaActiva].includes(i.categoria) : i.categoria === categoriaActiva));
                return {
                    t: items.reduce((a, c) => a + (Number(c.funcionales) + Number(c.noFuncionales)), 0),
                    ok: items.reduce((a, c) => a + Number(c.funcionales), 0),
                    bad: items.reduce((a, c) => a + Number(c.noFuncionales), 0)
                };
            }, [inventario, categoriaActiva]);

            const guardar = (e) => {
                e.preventDefault();
                setInventario([...inventario, { ...nuevoEquipo, id: Date.now(), stock: Number(nuevoEquipo.funcionales) + Number(nuevoEquipo.noFuncionales) }]);
                setIsModalOpen(false);
                setNuevoEquipo({ idEtiqueta: '', categoria: '', nombre: '', funcionales: 0, noFuncionales: 0 });
            };

            return (
                <div className="h-screen bg-[#f8fafc] flex overflow-hidden text-[#002d5b]">
                    {/* SIDEBAR */}
                    <aside className={`fixed inset-y-0 left-0 z-50 w-72 bg-[#002d5b] text-white transform transition-transform duration-300 lg:relative lg:translate-x-0 ${isSidebarOpen ? 'translate-x-0' : '-translate-x-full'}`}>
                        <div className="p-6 border-b border-white/10">
                            <h2 className="text-xl font-black italic text-[#4a90e2] mb-4">PROTEGE BIEN</h2>
                            <input type="text" placeholder="Filtrar rubros..." className="w-full bg-white/10 rounded-lg px-3 py-2 text-xs outline-none" onChange={(e) => setBusquedaRubro(e.target.value)} />
                        </div>
                        <nav className="p-4 space-y-2 overflow-y-auto h-[calc(100vh-150px)]">
                            <button onClick={() => {setCategoriaActiva("General"); setIsSidebarOpen(false);}} className={`w-full text-left p-3 rounded-xl font-black text-xs ${categoriaActiva === "General" ? 'bg-[#4a90e2]' : ''}`}>üìä PANEL GENERAL</button>
                            {Object.entries(estructuraEmpresa).map(([dept, rubros]) => (
                                <div key={dept}>
                                    <button onClick={() => setDeptsAbiertos({...deptsAbiertos, [dept]: !deptsAbiertos[dept]})} className="w-full flex justify-between p-2 text-[#4a90e2] font-black text-[10px] uppercase">
                                        {dept} <span>{deptsAbiertos[dept] ? '‚ñ≤' : '‚ñº'}</span>
                                    </button>
                                    {deptsAbiertos[dept] && rubros.filter(r => r.toLowerCase().includes(busquedaRubro.toLowerCase())).map(r => (
                                        <button key={r} onClick={() => {setCategoriaActiva(r); setIsSidebarOpen(false);}} className={`w-full text-left py-2 pl-6 text-xs ${categoriaActiva === r ? 'text-white font-bold' : 'text-slate-400'}`}>{r}</button>
                                    ))}
                                </div>
                            ))}
                        </nav>
                    </aside>

                    {/* MAIN */}
                    <main className="flex-1 flex flex-col overflow-hidden">
                        <header className="bg-white border-b p-4 lg:p-8">
                            <div className="flex justify-between items-center mb-4">
                                <button onClick={() => setIsSidebarOpen(true)} className="lg:hidden text-2xl">‚ò∞</button>
                                <h1 className="text-lg font-black uppercase italic">{categoriaActiva}</h1>
                                <button onClick={() => setIsModalOpen(true)} className="bg-[#002d5b] text-white px-4 py-2 rounded-xl font-black text-xs">+ NUEVO</button>
                            </div>
                            <div className="grid grid-cols-3 gap-2 mb-4">
                                <div className="bg-slate-50 p-2 rounded-xl border text-center"><span className="text-[8px] block text-slate-400 font-bold uppercase">Total</span><span className="font-black">{stats.t}</span></div>
                                <div className="bg-blue-50 p-2 rounded-xl border text-center"><span className="text-[8px] block text-[#4a90e2] font-bold uppercase">Disp</span><span className="font-black text-[#4a90e2]">{stats.ok}</span></div>
                                <div className="bg-rose-50 p-2 rounded-xl border text-center"><span className="text-[8px] block text-rose-400 font-bold uppercase">Baja</span><span className="font-black text-rose-600">{stats.bad}</span></div>
                            </div>
                            <input type="text" placeholder="Buscar producto..." className="w-full p-3 bg-slate-100 rounded-xl text-sm" onChange={e => setBusqueda(e.target.value)} />
                        </header>

                        <div className="flex-1 overflow-y-auto p-4 space-y-3 pb-20">
                            {inventarioFiltrado.map(item => (
                                <div key={item.id} className="bg-white p-4 rounded-2xl shadow-sm border">
                                    <div className="flex justify-between text-[10px] mb-1 font-black">
                                        <span className="text-[#4a90e2]">ID: {item.idEtiqueta}</span>
                                        <button onClick={() => setInventario(inventario.filter(i => i.id !== item.id))}>üóëÔ∏è</button>
                                    </div>
                                    <h3 className="font-black text-sm uppercase italic">{item.nombre}</h3>
                                    <div className="flex gap-4 mt-2">
                                        <div className="text-center"><span className="text-[8px] block text-slate-400 font-bold">STOCK</span><span className="font-black">{item.stock}</span></div>
                                        <div className="text-center"><span className="text-[8px] block text-[#4a90e2] font-bold">OK</span><span className="font-black text-[#4a90e2]">{item.funcionales}</span></div>
                                        <div className="text-center"><span className="text-[8px] block text-rose-400 font-bold">BAJA</span><span className="font-black text-rose-600">{item.noFuncionales}</span></div>
                                    </div>
                                    <StockBar actuales={item.funcionales} totales={item.stock} />
                                </div>
                            ))}
                        </div>

                        {isModalOpen && (
                            <div className="fixed inset-0 bg-black/80 z-[100] flex items-center justify-center p-4">
                                <form onSubmit={guardar} className="bg-white w-full max-w-sm rounded-3xl p-6 space-y-4">
                                    <h2 className="font-black uppercase italic">Nuevo Activo</h2>
                                    <input required className="w-full p-3 bg-slate-100 rounded-xl" placeholder="ID Etiqueta" onChange={e => setNuevoEquipo({...nuevoEquipo, idEtiqueta: e.target.value})} />
                                    <input required className="w-full p-3 bg-slate-100 rounded-xl" placeholder="Nombre / Marca" onChange={e => setNuevoEquipo({...nuevoEquipo, nombre: e.target.value})} />
                                    <input required className="w-full p-3 bg-slate-100 rounded-xl" placeholder="Categor√≠a" list="cats" onChange={e => setNuevoEquipo({...nuevoEquipo, categoria: e.target.value})} />
                                    <datalist id="cats">
                                        {Object.values(estructuraEmpresa).flat().map(c => <option key={c} value={c} />)}
                                    </datalist>
                                    <div className="grid grid-cols-2 gap-4">
                                        <input type="number" className="w-full p-3 bg-slate-100 rounded-xl" placeholder="Cant. OK" onChange={e => setNuevoEquipo({...nuevoEquipo, funcionales: e.target.value})} />
                                        <input type="number" className="w-full p-3 bg-slate-100 rounded-xl" placeholder="Cant. BAJA" onChange={e => setNuevoEquipo({...nuevoEquipo, noFuncionales: e.target.value})} />
                                    </div>
                                    <div className="flex gap-2">
                                        <button type="button" onClick={() => setIsModalOpen(false)} className="flex-1 py-3 font-bold">CANCELAR</button>
                                        <button type="submit" className="flex-1 py-3 bg-[#002d5b] text-white font-black rounded-xl">GUARDAR</button>
                                    </div>
                                </form>
                            </div>
                        )}
                    </main>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>