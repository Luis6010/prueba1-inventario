<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>Protege Bien - Sistema de Inventario</title>
    
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap');
        body { font-family: 'Montserrat', sans-serif; }
    </style>
</head>
<body class="bg-[#f8fafc]">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        const App = () => {
            const [inventario, setInventario] = useState(() => {
                const d = localStorage.getItem('pb_data_final');
                return d ? JSON.parse(d) : [];
            });
            const [cat, setCat] = useState("General");
            const [open, setOpen] = useState(false);
            const [modal, setModal] = useState(false);
            const [busqueda, setBusqueda] = useState("");
            const [nuevo, setNuevo] = useState({ idE: '', nom: '', ok: 0, bj: 0, cat: 'Laptops' });

            const depts = {
                "Tecnolog√≠a (TI)": ['Laptops', 'CPU', 'Celulares', 'Monitores', 'Teclados', 'Mouse', 'Cables', 'Impresoras', 'Telefonos', 'Mousepad', 'Extension', 'Cargadores', 'Adaptadores', 'Escaneres', 'Soporte Laptop', 'Soporte Pantalla', 'Pantalla', 'Repetidores', 'Preamplificadores', 'Switch', 'Alexa', 'Fuente Alimentacion', 'Memoria USB', 'Router', 'Camara', 'Disco', 'Trituradora', 'Convertidor', 'Transmisor', 'Control'],
                "Direccion": ['Paquetes Alcanfores', 'Paquetes Cerveza', 'Paquetes Para Tasas', 'Vinos', 'Tasas', 'Listones']
            };

            useEffect(() => { localStorage.setItem('pb_data_final', JSON.stringify(inventario)); }, [inventario]);

            const filtrados = useMemo(() => {
                return inventario.filter(i => {
                    const matchCat = cat === "General" || i.cat === cat;
                    const matchBusqueda = i.nom.toLowerCase().includes(busqueda.toLowerCase()) || i.idE.toLowerCase().includes(busqueda.toLowerCase());
                    return matchCat && matchBusqueda;
                });
            }, [inventario, cat, busqueda]);

            // --- FUNCIONES DE EXPORTACI√ìN ---
            const exportarExcel = () => {
                const dataParaExcel = filtrados.map(i => ({
                    ID: i.idE,
                    Nombre: i.nom,
                    Categor√≠a: i.cat,
                    Funcionales: i.ok,
                    Bajas: i.bj,
                    Total: Number(i.ok) + Number(i.bj)
                }));
                const ws = XLSX.utils.json_to_sheet(dataParaExcel);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, "Inventario");
                XLSX.writeFile(wb, `Inventario_${cat}_${new Date().toLocaleDateString()}.xlsx`);
            };

            const exportarPDF = () => {
                const doc = new jspdf.jsPDF();
                doc.text(`Reporte de Inventario: ${cat}`, 14, 15);
                const tabla = filtrados.map(i => [i.idE, i.nom, i.cat, i.ok, i.bj, Number(i.ok) + Number(i.bj)]);
                doc.autoTable({
                    head: [['ID', 'Nombre', 'Categor√≠a', 'OK', 'Baja', 'Total']],
                    body: tabla,
                    startY: 20
                });
                doc.save(`Inventario_${cat}.pdf`);
            };

            return (
                <div className="flex h-screen overflow-hidden">
                    {/* Sidebar */}
                    <aside className={`${open ? 'translate-x-0' : '-translate-x-full'} fixed inset-y-0 left-0 z-50 w-72 bg-[#002d5b] text-white transition-transform lg:relative lg:translate-x-0 shadow-2xl`}>
                        <div className="p-6 border-b border-white/10 font-black italic text-[#4a90e2] text-2xl tracking-tighter">PROTEGE BIEN</div>
                        <nav className="p-4 overflow-y-auto h-full pb-32">
                            <button onClick={() => {setCat("General"); setOpen(false);}} className={`w-full text-left p-4 rounded-xl font-black text-xs mb-6 ${cat === "General" ? 'bg-[#4a90e2]' : 'bg-white/5'}`}>üìä PANEL GENERAL</button>
                            {Object.entries(depts).map(([d, items]) => (
                                <div key={d} className="mb-6">
                                    <p className="text-[10px] text-[#4a90e2] font-black uppercase px-3 mb-3 tracking-widest">{d}</p>
                                    <div className="space-y-1">
                                        {items.map(i => (
                                            <button key={i} onClick={() => {setCat(i); setOpen(false);}} className={`w-full text-left py-2 px-6 rounded-lg text-[11px] transition-all ${cat === i ? 'bg-white/10 text-white font-bold' : 'text-slate-400 hover:text-white'}`}>{i}</button>
                                        ))}
                                    </div>
                                </div>
                            ))}
                        </nav>
                    </aside>

                    {/* Main */}
                    <main className="flex-1 flex flex-col min-w-0 bg-[#f8fafc]">
                        <header className="p-4 lg:p-8 bg-white border-b">
                            <div className="flex justify-between items-center mb-6">
                                <button onClick={() => setOpen(true)} className="lg:hidden text-2xl">‚ò∞</button>
                                <h1 className="font-black uppercase italic text-lg text-[#002d5b] truncate pr-4">{cat}</h1>
                                <button onClick={() => setModal(true)} className="bg-[#002d5b] text-white px-5 py-2.5 rounded-xl font-black text-[10px] shadow-lg">+ NUEVO</button>
                            </div>

                            {/* Botones de Exportaci√≥n */}
                            <div className="flex gap-2 mb-6">
                                <button onClick={exportarExcel} className="flex-1 bg-emerald-50 text-emerald-700 border border-emerald-100 py-2 rounded-xl font-black text-[9px] uppercase">Excel üìó</button>
                                <button onClick={exportarPDF} className="flex-1 bg-rose-50 text-rose-700 border border-rose-100 py-2 rounded-xl font-black text-[9px] uppercase">PDF üìï</button>
                            </div>

                            <input className="w-full p-4 bg-slate-100 rounded-2xl text-sm outline-none focus:ring-2 ring-blue-500/20" placeholder="üîç Buscar por nombre o ID..." value={busqueda} onChange={e => setBusqueda(e.target.value)} />
                        </header>

                        <div className="flex-1 overflow-y-auto p-4 space-y-4 pb-24">
                            {filtrados.map(i => (
                                <div key={i.id} className="bg-white p-5 rounded-[2rem] shadow-sm border border-slate-100 relative">
                                    <div className="flex justify-between text-[9px] font-black text-blue-500 mb-2">
                                        <span className="bg-blue-50 px-2 py-1 rounded-md tracking-tighter uppercase">ID: {i.idE}</span>
                                        <button onClick={() => {if(confirm('¬øBorrar?')) setInventario(prev => prev.filter(x => x.id !== i.id))}} className="text-slate-300 hover:text-rose-500 text-base">üóëÔ∏è</button>
                                    </div>
                                    <p className="font-black italic uppercase text-[#002d5b] text-base mb-4 tracking-tighter">{i.nom}</p>
                                    <div className="grid grid-cols-3 gap-3">
                                        <div className="bg-slate-900 text-white p-3 rounded-2xl text-center">
                                            <span className="block text-[8px] font-bold text-slate-400 uppercase">Total</span>
                                            <span className="font-black text-lg">{Number(i.ok)+Number(i.bj)}</span>
                                        </div>
                                        <div className="bg-blue-50 text-blue-700 p-3 rounded-2xl text-center">
                                            <span className="block text-[8px] font-bold text-blue-400 uppercase">OK</span>
                                            <span className="font-black text-lg">{i.ok}</span>
                                        </div>
                                        <div className="bg-red-50 text-red-600 p-3 rounded-2xl text-center">
                                            <span className="block text-[8px] font-bold text-red-400 uppercase">Baja</span>
                                            <span className="font-black text-lg">{i.bj}</span>
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>

                        {/* Modal */}
                        {modal && (
                            <div className="fixed inset-0 bg-[#002d5b]/80 backdrop-blur-sm z-[100] flex items-end lg:items-center justify-center">
                                <div className="bg-white rounded-t-[3rem] lg:rounded-[3rem] p-8 w-full max-w-lg shadow-2xl">
                                    <h2 className="font-black text-[#002d5b] text-xl mb-6 uppercase italic">Nuevo Registro</h2>
                                    <div className="space-y-4">
                                        <input className="w-full p-4 bg-slate-50 border rounded-2xl font-bold" placeholder="ID Etiqueta" onChange={e => setNuevo({...nuevo, idE: e.target.value})} />
                                        <input className="w-full p-4 bg-slate-50 border rounded-2xl font-bold" placeholder="Nombre del Equipo" onChange={e => setNuevo({...nuevo, nom: e.target.value})} />
                                        <select className="w-full p-4 bg-slate-50 border rounded-2xl font-bold" onChange={e => setNuevo({...nuevo, cat: e.target.value})}>
                                            {Object.values(depts).flat().map(x => <option key={x} value={x}>{x}</option>)}
                                        </select>
                                        <div className="grid grid-cols-2 gap-4">
                                            <input type="number" className="p-4 bg-blue-50 rounded-2xl font-black text-center text-blue-700" placeholder="OK" onChange={e => setNuevo({...nuevo, ok: e.target.value})} />
                                            <input type="number" className="p-4 bg-red-50 rounded-2xl font-black text-center text-red-700" placeholder="Baja" onChange={e => setNuevo({...nuevo, bj: e.target.value})} />
                                        </div>
                                        <div className="flex gap-4 pt-4">
                                            <button onClick={() => setModal(false)} className="flex-1 font-bold text-slate-400 uppercase text-xs">Cancelar</button>
                                            <button onClick={() => {
                                                setInventario([...inventario, {...nuevo, id: Date.now()}]);
                                                setModal(false);
                                            }} className="flex-1 bg-[#002d5b] text-white py-5 rounded-[1.5rem] font-black uppercase text-xs shadow-xl active:scale-95">Guardar</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
